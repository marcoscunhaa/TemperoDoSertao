import{a as G}from"./chunk-LCCTAROR.js";import{d as q,g as H,l as $,m as Q,n as U,q as Y,s as J}from"./chunk-OMFGSIQ2.js";import{h as C,i as z,j as W,k}from"./chunk-AW5XL4A6.js";import{Ba as B,Ha as F,Ma as R,Na as P,Sa as j,Ta as S,Ua as x,Va as O,Wa as t,Xa as a,Ya as b,cb as V,db as _,fb as i,gb as s,hb as E,ib as w,jb as D,kb as y,lb as A,na as o,pb as c,qb as T,rb as M,xa as h}from"./chunk-2O5W7GKA.js";var Z=()=>[C,z],ee=(d,e)=>e.id;function te(d,e){if(d&1&&(t(0,"option",22),i(1),c(2,"titlecase"),a()),d&2){let n=e.$implicit;O("value",A(n)),o(),s(T(2,3,n))}}function ae(d,e){if(d&1&&(t(0,"tr")(1,"td"),i(2),c(3,"date"),a(),t(4,"td"),i(5),c(6,"titlecase"),a(),t(7,"td"),i(8),a(),t(9,"td"),i(10),a(),t(11,"td"),i(12),a(),t(13,"td"),i(14),a(),t(15,"td"),i(16),a(),t(17,"td",26),i(18),a()()),d&2){let n=e.$implicit,r=_(2);o(2),s(M(3,8,n.dataVenda,"dd/MM/yyyy")),o(3),s(T(6,11,n.categoria)),o(3),s(n.produto),o(2),s(n.marca),o(2),s(r.formatarMoeda(n.precoVenda)),o(2),s(n.quantidadeVendida),o(2),s(n.formaPagamento),o(2),s(r.formatarLucro(n))}}function ie(d,e){d&1&&(t(0,"tr")(1,"td",27),i(2,"Nenhuma venda encontrada."),a()())}function ne(d,e){if(d&1&&(t(0,"table",24)(1,"thead",25)(2,"tr")(3,"th"),i(4,"Data da Venda"),a(),t(5,"th"),i(6,"Categoria"),a(),t(7,"th"),i(8,"Produto"),a(),t(9,"th"),i(10,"Marca"),a(),t(11,"th"),i(12,"Valor de Venda(R$)"),a(),t(13,"th"),i(14,"Quantidade"),a(),t(15,"th"),i(16,"Forma de Pagamento"),a(),t(17,"th"),i(18,"Lucro(R$)"),a()()(),t(19,"tbody"),S(20,ae,19,13,"tr",null,ee,!1,ie,3,0,"tr"),a()()),d&2){let n=_();o(20),x(n.vendasFiltradas)}}function re(d,e){d&1&&(t(0,"div",28)(1,"div",29),i(2,"Nenhuma venda encontrada."),a()())}var K=class d{constructor(e,n){this.vendaService=e;this.notificacaoService=n}vendas=[];vendasFiltradas=[];resumo={totalVendido:0,totalComprado:0,lucroBruto:0,margemLucro:0};categorias=["todas","carnes","temperos","bebidas","frios","doces"];categoriaSelecionada="todas";filtroTempo="diario";dataAtualizacao="";alertaMensagem=null;tipoAlerta="success";ngOnInit(){this.setDataAtualizacao(),this.carregarResumo(),this.carregarVendas(),this.notificacaoService.notificacao$.subscribe(e=>{this.alertaMensagem=e.mensagem,this.tipoAlerta=e.tipo,this.carregarVendas(),this.carregarResumo()})}setDataAtualizacao(){let e=new Date,n={month:"short",year:"numeric"};this.dataAtualizacao=e.toLocaleDateString("pt-BR",n).toUpperCase()}carregarVendas(){this.vendaService.listarVendas().subscribe({next:e=>{this.vendas=e,this.filtrarVendas()}})}carregarResumo(){this.vendaService.getResumo().subscribe({next:e=>this.resumo=e,error:e=>console.error("Erro ao carregar resumo:",e)})}filtrarCategoria(e){this.categoriaSelecionada=e,this.filtrarVendas()}filtrarTempo(e){this.filtroTempo=e,this.filtrarVendas()}filtrarVendas(){let e=new Date,n=e.getFullYear(),r=e.getMonth(),m=e.getDate();this.vendasFiltradas=this.vendas.filter(l=>{let{ano:f,mes:g,dia:I}=oe(l.dataVenda),X=this.categoriaSelecionada==="todas"||l.categoria.toLowerCase()===this.categoriaSelecionada.toLowerCase(),p=!0;if(this.filtroTempo==="diario")p=f===n&&g===r&&I===m;else if(this.filtroTempo==="semanal"){let N=new Date(f,g,I),v=new Date(n,r,m),u=new Date(v);u.setDate(v.getDate()-v.getDay());let L=new Date(u);L.setDate(u.getDate()+6),p=N>=u&&N<=L}else this.filtroTempo==="mensal"&&(p=f===n&&g===r);return X&&p})}formatarMoeda(e){return e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}formatarLucro(e){let n=e.precoCompra??0,r=e.precoVenda??0,m=e.quantidadeVendida??1,l=(r-n)*m;return this.formatarMoeda(l)}finalizarVenda(e){this.vendaService.criarVenda(e).subscribe({next:n=>{this.vendas.push(n),this.filtrarVendas(),this.carregarResumo()},error:n=>console.error("Erro ao finalizar venda:",n)})}static \u0275fac=function(n){return new(n||d)(h(G),h(J))};static \u0275cmp=B({type:d,selectors:[["app-vendas"]],decls:54,vars:11,consts:[[1,"card","shadow-lg","rounded-4","p-4","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"m-0","fw-bold","text-success"],[1,"bi","bi-bar-chart-line","me-2"],[1,"badge","bg-success","fs-6","px-3","py-2","shadow-sm"],[1,"row","text-center","mb-4"],[1,"col-md-3","mb-2"],[1,"card","shadow-sm","border-0","rounded-3","p-3"],[1,"text-muted","fw-semibold"],[1,"fs-5","fw-bold","text-success"],[1,"fs-5","fw-bold","text-danger"],[1,"fs-5","fw-bold","text-primary"],[1,"fs-5","fw-bold","text-warning"],[1,"card","shadow-sm","border-0","rounded-3"],[1,"card-header","bg-success","text-white","d-flex","justify-content-between","align-items-center","flex-wrap","gap-2"],[1,"fw-semibold"],[1,"bi","bi-clipboard-data","me-2"],[1,"d-flex","gap-2"],[1,"form-select","w-auto","bg-light","border-0","shadow-sm","fw-semibold",3,"ngModelChange","change","ngModel"],["value","diario"],["value","semanal"],["value","mensal"],[3,"value"],[1,"card-body","p-0"],[1,"table","table-hover","align-middle","mb-0","text-center"],[1,"table-light","fw-bold"],[1,"text-success","fw-bold"],["colspan","8",1,"py-4","text-muted"],[1,"text-center","py-5"],[1,"mt-2","text-muted","fw-semibold"]],template:function(n,r){n&1&&(t(0,"div",0)(1,"div",1)(2,"h3",2),b(3,"i",3),i(4,"Resumo de Vendas "),a(),t(5,"span",4),i(6),a()(),t(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8),i(11,"Total Vendido"),a(),t(12,"div",9),i(13),a()()(),t(14,"div",6)(15,"div",7)(16,"div",8),i(17,"Total Comprado"),a(),t(18,"div",10),i(19),a()()(),t(20,"div",6)(21,"div",7)(22,"div",8),i(23,"Lucro Bruto"),a(),t(24,"div",11),i(25),a()()(),t(26,"div",6)(27,"div",7)(28,"div",8),i(29,"Margem de Lucro"),a(),t(30,"div",12),i(31),c(32,"number"),a()()()(),t(33,"div",13)(34,"div",14)(35,"span",15),b(36,"i",16),i(37,"Vendas "),a(),t(38,"div",17)(39,"select",18),y("ngModelChange",function(l){return D(r.filtroTempo,l)||(r.filtroTempo=l),l}),V("change",function(){return r.filtrarVendas()}),t(40,"option",19),i(41,"Vendas Di\xE1rias"),a(),t(42,"option",20),i(43,"Vendas Semanais"),a(),t(44,"option",21),i(45,"Vendas Mensais"),a()(),t(46,"select",18),y("ngModelChange",function(l){return D(r.categoriaSelecionada,l)||(r.categoriaSelecionada=l),l}),V("change",function(){return r.filtrarVendas()}),S(47,te,3,5,"option",22,j),a()()(),t(49,"div",23),F(50,ne,23,1)(51,re,3,0),R(52,50,Z,null,51),a()()()),n&2&&(o(6),E(" Atualizado: ",r.dataAtualizacao," "),o(7),s(r.formatarMoeda(r.resumo.totalVendido)),o(6),s(r.formatarMoeda(r.resumo.totalComprado)),o(6),s(r.formatarMoeda(r.resumo.lucroBruto)),o(6),E("",M(32,8,r.resumo.margemLucro,"1.1-2"),"%"),o(8),w("ngModel",r.filtroTempo),o(7),w("ngModel",r.categoriaSelecionada),o(),x(r.categorias),o(5),P(r.vendasFiltradas.length>0))},dependencies:[k,Y,Q,U,$,q,H,W,C],encapsulation:2})};function oe(d){let[e,n,r]=d.split("-");return{ano:Number(e),mes:Number(n)-1,dia:Number(r)}}export{K as Vendas};
