import './polyfills.server.mjs';
import{a as k}from"./chunk-GY3WU7ON.mjs";import{d as A,g as R,l as O,m as P,n as W,q as z,s as j}from"./chunk-4MM2DZNH.mjs";import{j as C,k as B,l as F,m as L}from"./chunk-WVJUZVRJ.mjs";import{$a as a,Da as T,Ja as I,Qa as D,Ra as N,Wa as g,Xa as p,Ya as u,Za as c,_a as t,ab as V,gb as v,hb as E,jb as n,kb as m,lb as y,mb as S,nb as h,ob as b,pa as d,sb as f,tb as w,ub as M,za as x}from"./chunk-7RJWP5G5.mjs";import"./chunk-X2SEQXRR.mjs";var $=()=>[C,B],Q=(o,e)=>e.id;function U(o,e){if(o&1&&(t(0,"option",19),n(1),f(2,"titlecase"),a()),o&2){let i=e.$implicit;c("ngValue",i),d(),m(w(2,2,i))}}function Y(o,e){if(o&1&&(t(0,"option",19),n(1),a()),o&2){let i=e.$implicit;c("ngValue",i.valor),d(),m(i.nome)}}function G(o,e){if(o&1&&(t(0,"option",19),n(1),a()),o&2){let i=e.$implicit;c("ngValue",i),d(),m(i)}}function H(o,e){if(o&1&&(t(0,"tr")(1,"td"),n(2),f(3,"date"),a(),t(4,"td"),n(5),f(6,"titlecase"),a(),t(7,"td"),n(8),a(),t(9,"td"),n(10),a(),t(11,"td"),n(12),a(),t(13,"td"),n(14),a(),t(15,"td"),n(16),a(),t(17,"td",23),n(18),a()()),o&2){let i=e.$implicit,r=E(2);d(2),m(M(3,8,i.dataVenda,"dd/MM/yyyy")),d(3),m(w(6,11,i.categoria)),d(3),m(i.produto),d(2),m(i.marca),d(2),m(r.formatarMoeda(i.precoVenda)),d(2),m(i.quantidadeVendida),d(2),m(i.formaPagamento),d(2),m(r.formatarLucro(i))}}function K(o,e){o&1&&(t(0,"tr")(1,"td",24),n(2,"Nenhuma venda encontrada."),a()())}function X(o,e){if(o&1&&(t(0,"table",21)(1,"thead",22)(2,"tr")(3,"th"),n(4,"Data da Venda"),a(),t(5,"th"),n(6,"Categoria"),a(),t(7,"th"),n(8,"Produto"),a(),t(9,"th"),n(10,"Marca"),a(),t(11,"th"),n(12,"Valor de Venda(R$)"),a(),t(13,"th"),n(14,"Quantidade"),a(),t(15,"th"),n(16,"Forma de Pagamento"),a(),t(17,"th"),n(18,"Lucro(R$)"),a()()(),t(19,"tbody"),p(20,H,19,13,"tr",null,Q,!1,K,3,0,"tr"),a()()),o&2){let i=E();d(20),u(i.vendasFiltradas)}}function Z(o,e){o&1&&(t(0,"div",25)(1,"div",26),n(2,"Nenhuma venda encontrada."),a()())}var q=class o{constructor(e,i){this.vendaService=e;this.notificacaoService=i}vendas=[];vendasFiltradas=[];resumo={totalVendido:0,totalComprado:0,lucroBruto:0,margemLucro:0};categorias=["todas","carnes","temperos","bebidas","frios","doces"];categoriaSelecionada="todas";anos=[];anoSelecionado="todos";meses=[{nome:"Janeiro",valor:0},{nome:"Fevereiro",valor:1},{nome:"Mar\xE7o",valor:2},{nome:"Abril",valor:3},{nome:"Maio",valor:4},{nome:"Junho",valor:5},{nome:"Julho",valor:6},{nome:"Agosto",valor:7},{nome:"Setembro",valor:8},{nome:"Outubro",valor:9},{nome:"Novembro",valor:10},{nome:"Dezembro",valor:11}];mesSelecionado="todos";dataAtualizacao="";alertaMensagem=null;tipoAlerta="success";ngOnInit(){this.setDataAtualizacao(),this.anos=Array.from({length:11},(e,i)=>2025+i),this.carregarResumo(),this.carregarVendas(),this.notificacaoService.notificacao$.subscribe(e=>{this.alertaMensagem=e.mensagem,this.tipoAlerta=e.tipo,this.carregarVendas(),this.carregarResumo()})}setDataAtualizacao(){let e=new Date,i={month:"short",year:"numeric"};this.dataAtualizacao=e.toLocaleDateString("pt-BR",i).toUpperCase()}carregarVendas(){this.vendaService.listarVendas().subscribe({next:e=>{this.vendas=e,this.filtrarVendas()}})}carregarResumo(){this.vendaService.getResumo().subscribe({next:e=>this.resumo=e,error:e=>console.error("Erro ao carregar resumo:",e)})}filtrarVendas(){this.vendasFiltradas=this.vendas.filter(e=>{let{ano:i,mes:r}=ee(e.dataVenda),l=this.categoriaSelecionada==="todas"||e.categoria.toLowerCase()===this.categoriaSelecionada.toLowerCase(),s=this.anoSelecionado==="todos"||i===this.anoSelecionado,_=this.mesSelecionado==="todos"||r===this.mesSelecionado;return l&&s&&_})}formatarMoeda(e){return e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}formatarLucro(e){let i=e.precoCompra??0,r=e.precoVenda??0,l=e.quantidadeVendida??1,s=(r-i)*l;return this.formatarMoeda(s)}finalizarVenda(e){this.vendaService.criarVenda(e).subscribe({next:i=>{this.vendas.push(i),this.filtrarVendas(),this.carregarResumo()},error:i=>console.error("Erro ao finalizar venda:",i)})}static \u0275fac=function(i){return new(i||o)(x(k),x(j))};static \u0275cmp=T({type:o,selectors:[["app-vendas"]],decls:57,vars:14,consts:[[1,"card","shadow-lg","rounded-4","p-4","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"m-0","fw-bold","text-success"],[1,"bi","bi-bar-chart-line","me-2"],[1,"badge","bg-success","fs-6","px-3","py-2","shadow-sm"],[1,"row","text-center","mb-4"],[1,"col-md-3","mb-2"],[1,"card","shadow-sm","border-0","rounded-3","p-3"],[1,"text-muted","fw-semibold"],[1,"fs-5","fw-bold","text-success"],[1,"fs-5","fw-bold","text-danger"],[1,"fs-5","fw-bold","text-primary"],[1,"fs-5","fw-bold","text-warning"],[1,"card","shadow-sm","border-0","rounded-3"],[1,"card-header","bg-success","text-white","d-flex","justify-content-between","align-items-center","flex-wrap","gap-2"],[1,"fw-semibold"],[1,"bi","bi-clipboard-data","me-2"],[1,"d-flex","gap-2","flex-wrap"],[1,"form-select","w-auto","bg-light","border-0","shadow-sm","fw-semibold",3,"ngModelChange","change","ngModel"],[3,"ngValue"],[1,"card-body","p-0"],[1,"table","table-hover","align-middle","mb-0","text-center"],[1,"table-light","fw-bold"],[1,"text-success","fw-bold"],["colspan","8",1,"py-4","text-muted"],[1,"text-center","py-5"],[1,"mt-2","text-muted","fw-semibold"]],template:function(i,r){i&1&&(t(0,"div",0)(1,"div",1)(2,"h3",2),V(3,"i",3),n(4,"Resumo de Vendas "),a(),t(5,"span",4),n(6),a()(),t(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8),n(11,"Total Vendido"),a(),t(12,"div",9),n(13),a()()(),t(14,"div",6)(15,"div",7)(16,"div",8),n(17,"Total Comprado"),a(),t(18,"div",10),n(19),a()()(),t(20,"div",6)(21,"div",7)(22,"div",8),n(23,"Lucro Bruto"),a(),t(24,"div",11),n(25),a()()(),t(26,"div",6)(27,"div",7)(28,"div",8),n(29,"Margem de Lucro"),a(),t(30,"div",12),n(31),f(32,"number"),a()()()(),t(33,"div",13)(34,"div",14)(35,"span",15),V(36,"i",16),n(37,"Vendas "),a(),t(38,"div",17)(39,"select",18),b("ngModelChange",function(s){return h(r.categoriaSelecionada,s)||(r.categoriaSelecionada=s),s}),v("change",function(){return r.filtrarVendas()}),p(40,U,3,4,"option",19,g),a(),t(42,"select",18),b("ngModelChange",function(s){return h(r.mesSelecionado,s)||(r.mesSelecionado=s),s}),v("change",function(){return r.filtrarVendas()}),t(43,"option",19),n(44,"Todos Meses"),a(),p(45,Y,2,2,"option",19,g),a(),t(47,"select",18),b("ngModelChange",function(s){return h(r.anoSelecionado,s)||(r.anoSelecionado=s),s}),v("change",function(){return r.filtrarVendas()}),t(48,"option",19),n(49,"Todos Anos"),a(),p(50,G,2,2,"option",19,g),a()()(),t(52,"div",20),I(53,X,23,1)(54,Z,3,0),D(55,53,$,null,54),a()()()),i&2&&(d(6),y(" Atualizado: ",r.dataAtualizacao," "),d(7),m(r.formatarMoeda(r.resumo.totalVendido)),d(6),m(r.formatarMoeda(r.resumo.totalComprado)),d(6),m(r.formatarMoeda(r.resumo.lucroBruto)),d(6),y("",M(32,11,r.resumo.margemLucro,"1.1-2"),"%"),d(8),S("ngModel",r.categoriaSelecionada),d(),u(r.categorias),d(2),S("ngModel",r.mesSelecionado),d(),c("ngValue","todos"),d(2),u(r.meses),d(2),S("ngModel",r.anoSelecionado),d(),c("ngValue","todos"),d(2),u(r.anos),d(5),N(r.vendasFiltradas.length>0))},dependencies:[L,z,P,W,O,A,R,F,C],encapsulation:2})};function ee(o){if(!o||o.trim().length<8)return{ano:0,mes:0,dia:0};if(o=o.trim(),o.includes("T")){let l=new Date(o);return{ano:l.getFullYear(),mes:l.getMonth(),dia:l.getDate()}}if(o.includes("/")){let[l,s,_]=o.split("/").map(J=>J.trim());return{ano:Number(_),mes:Number(s)-1,dia:Number(l)}}let[e,i,r]=o.split("-").map(l=>l.trim());return{ano:Number(e),mes:Number(i)-1,dia:Number(r)}}export{q as Vendas};
